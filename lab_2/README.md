# Лабораторная работа: Верификация автомата подачи корма для белок в SPIN

## Описание модели

Модель `squirrel_feeder.pml` реализует систему автоматической подачи корма для белок с использованием языка Promela. Основные компоненты:

- **Процесс Controller** - управляющая логика системы
- **Датчики**:
  - `squirrel_present` - присутствие белки (бит)
  - `food_count` - уровень корма (0..MAX_FOOD)
- **Исполнительные механизмы**:
  - `feed_motor` - мотор подачи корма
  - `signal_light` - сигнальная лампа

## Параметры системы

```promela
#define MAX_FOOD 3               // Максимальная емкость кормушки
#define MAX_SQUIRREL_ABSENCE 128 // Макс. время отсутствия белки
```

## Запуск верификации

1. Генерация верификатора:
   ```bash
   spin -a squirrel_feeder.pml
   ```

2. Компиляция:
   ```bash
   gcc -o pan pan.c -O2
   ```

3. Проверка свойств:
   ```bash
   # Проверка конкретного свойства
   ./pan -a -N "p0"
   ./pan -a -N "p1"
   ./pan -a -N "p2"
   ./pan -a -N "p3"
   ```

## Спецификации LTL

### 1. Активность белки (p0)
```promela
ltl p0 { []<>(squirrel_present) }
```
**Смысл**: Белка появляется бесконечно часто (условие fairness)

### 2. Корректность подачи корма (p1)
```promela
ltl p1 { [](squirrel_present -> <> (controller_state == dispense)) }
```
**Смысл**: При появлении белки корм будет выдан

### 3. Пополнение корма (p2)
```promela
ltl p2 { []( !food_available -> <> food_available ) }
```
**Смысл**: Система гарантирует пополнение корма при опустошении

### 4. Безопасность при пустом бункере (p3)
```promela
ltl p3 { [] ( (squirrel_present && food_count == 0) -> 
              (! (controller_state == dispense) U (food_count == MAX_FOOD)) ) }
```
**Смысл**: Подача не активируется при отсутствии корма до пополнения

## Структура модели

### Ключевые переменные:
| Переменная          | Тип               | Описание                     |
|---------------------|-------------------|------------------------------|
| `controller_state`  | `mtype`           | Состояние контроллера        |
| `food_count`        | `byte`            | Текущий уровень корма        |
| `refill_timer`      | `byte`            | Таймер пополнения корма      |

### Основная логика процесса Controller:
1. Обновление таймера отсутствия белки
2. Недетерминированное появление белки
3. Управление подачей корма:
   - Активация мотора при наличии белки и корма
   - Пополнение корма через 5 тактов
4. Управление сигнальной лампой

## Анализ результатов

Интерпретация вывода SPIN:
Запуск производился следующим образом 
   ```bash
   ./pan -a -b -m100000 -N p* 
   ```

Опция `-b` гарантирует выдачу ошибки, если глубина `-m*` недостаточна для проверки свойства.
Все свойства выполнены.

## Отличия от nuXmv-версии

1. **Асинхронная модель** - недетерминированный порядок выполнения
2. **Явный процесс** - логика выделена в proctype Controller
3. **Синтаксис LTL**:
   - `[]` вместо `G`
   - `<>` вместо `F`